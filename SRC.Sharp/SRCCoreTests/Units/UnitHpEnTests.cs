using Microsoft.VisualStudio.TestTools.UnitTesting;
using SRCCore.TestLib;
using SRCCore.Units;

namespace SRCCore.Units.Tests
{
    /// <summary>
    /// Unit の HP/EN のユニットテスト
    /// </summary>
    [TestClass]
    public class UnitHpEnTests
    {
        private SRC CreateSrc()
        {
            return new SRC
            {
                GUI = new MockGUI(),
            };
        }

        // ──────────────────────────────────────────────
        // HP (HP は MaxHP にクランプされる)
        // ──────────────────────────────────────────────

        [TestMethod]
        public void HP_SetPositive_SetsValue()
        {
            var src = CreateSrc();
            var unit = new Unit(src);
            // MaxHP minimum is 1, so any value <= 1 passes through
            unit.HP = 1;
            Assert.AreEqual(1, unit.HP);
        }

        [TestMethod]
        public void HP_SetNegative_ClampsToZero()
        {
            var src = CreateSrc();
            var unit = new Unit(src);
            unit.HP = -10;
            Assert.AreEqual(0, unit.HP);
        }

        [TestMethod]
        public void HP_SetAboveMaxHP_ClampsToMaxHP()
        {
            var src = CreateSrc();
            var unit = new Unit(src);
            // MaxHP minimum is 1 when no UnitData
            unit.HP = 9999;
            Assert.AreEqual(unit.MaxHP, unit.HP);
        }

        [TestMethod]
        public void MaxHP_MinimumIsOne()
        {
            var src = CreateSrc();
            var unit = new Unit(src);
            Assert.IsTrue(unit.MaxHP >= 1);
        }

        // ──────────────────────────────────────────────
        // EN
        // ──────────────────────────────────────────────

        [TestMethod]
        public void EN_SetNegative_ClampsToZero()
        {
            var src = CreateSrc();
            var unit = new Unit(src);
            unit.EN = -10;
            Assert.AreEqual(0, unit.EN);
        }

        [TestMethod]
        public void EN_SetAboveMaxEN_ClampsToMaxEN()
        {
            var src = CreateSrc();
            var unit = new Unit(src);
            unit.EN = 9999;
            Assert.AreEqual(unit.MaxEN, unit.EN);
        }

        // ──────────────────────────────────────────────
        // Party
        // ──────────────────────────────────────────────

        [TestMethod]
        public void Party_SetAndGet_Works()
        {
            var src = CreateSrc();
            var unit = new Unit(src);
            unit.Party = "味方";
            Assert.AreEqual("味方", unit.Party);
        }

        // ──────────────────────────────────────────────
        // Status
        // ──────────────────────────────────────────────

        [TestMethod]
        public void Status_DefaultIsWaitState()
        {
            var src = CreateSrc();
            var unit = new Unit(src);
            // 初期ステータスは「待機」
            Assert.AreEqual("待機", unit.Status);
        }

        [TestMethod]
        public void Status_SetAndGet_Works()
        {
            var src = CreateSrc();
            var unit = new Unit(src);
            unit.Status = "他形態";
            Assert.AreEqual("他形態", unit.Status);
        }
    }
}
